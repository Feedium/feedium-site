<!DOCTYPE html>
<html amp lang="{{ .Site.Params.languageCode }}" dir="{{ .Site.Params.htmlDirection }}">
<head>
  {{ partial "amp/head-amp.html" . }}
</head>
<body class="{{if eq .Kind `page` }}single{{else}}list{{end}}">
  {{ partial "amp/nav-amp.html" . }}
  <div class="main">
    <div class="main-head">
      <div class="cleafix"></div>
      <div class="main-title">
        <h1 class="post-title">{{ .Title }}</h1>
        <h3 class="post-subtitle">{{ .Params.subtitle }}</h3>
        {{ if eq .Params.config.coverVisibility "true" }}
        {{ $avatarImageResource := ($.Site.GetPage "section" "uploads").Resources.GetMatch (strings.TrimPrefix "/uploads/" (printf "%s" ((index .Site.Data.author (printf "%s" .Params.author)).avatar)) ) }}
        {{ $avatarResized := $avatarImageResource.Resize "72x q85" }}
        <div class="post-author ">
          <div>
            <div class="avatar">
              <amp-img 
                class="asyncImage"
                layout="responsive"
                height="64"
                width="64"
                src="{{ $avatarResized.RelPermalink }}" 
                alt='{{ (index .Site.Data.author (printf "%s" .Params.author)).name }}' 
                aria-label='{{ (index .Site.Data.author (printf "%s" .Params.author)).name }}'
                aria-hidden="true" >
              </amp-img>
            </div>                  
            <span>
              <p><strong>{{ (index .Site.Data.author (printf "%s" .Params.author)).name }}</strong></p>
              <p class="date">{{ .Params.shamsiDate }}</p>
            </span>
          </div>    
        </div>
        {{ end }}
        {{ if eq .Params.config.summaryVisibility "true" }}
        <div class="post-summary">
          <p>{{ .Params.summary }}</p>
        </div>
        {{ end }}

        {{ if eq .Params.config.coverVisibility "true" }}
        {{ $resizedCover := "null" }}
        {{ $tinyCover := "null" }}    
        {{ with .Params.cover }}
        {{ $imageResource := ($.Site.GetPage "section" "uploads").Resources.GetMatch (strings.TrimPrefix "/uploads/" . ) }}
        {{ $resizedCover = $imageResource.Fill "1100x700 center" }}
        {{ end }}
        {{ if ne $resizedCover "null" }}
        <div class="post-cover">
          <div>
            <amp-img 
              class="asyncImage" 
              layout="responsive"
              height="700"
              width="1100"                    
              src="{{ $resizedCover.RelPermalink }}" 
              aria-label="{{ .Params.Title}}">
            </amp-img>
            <span>source</span>
          </div>
        </div>
        {{ end }}
        {{ end }}
        {{/*  <div class="normal-view">
          <a class="btn" href="{{ replace .Permalink "/amp/"  "/" }}">نمایش مطلب در حالت استاندارد</a>
        </div>              */}}
      </div>
    </div>
    <div class="main-content" id="content">{{ .Content }}</div>
    <div class="main-footer">
      {{ if .Params.topic }}
      <div class="main-footer-tagline">
        <div>
          {{/*  {{ partial "modules/svg/folder.svg" . }}  */}}
          <ul class="footer-tags">
            {{ range .Params.topic }}
            <li><a href="{{$.Site.BaseURL}}/topic/{{ . | urlize }}/amp/">#{{ (index $.Site.Data.topic (printf "%s" . )).name }}</a></li>
            {{ end }}                               
          </ul>
        </div>
      </div>
      {{ end }}     

    </div>
  </div>
  {{ if eq .Params.config.related "true"}}
  {{ partial "amp/related-amp.html" . }}
  {{ end }}
  {{ partial "modules/footer.html" .}}
  <amp-install-serviceworker 
    src="{{ .Site.BaseURL }}/amp/sw.js"
    data-iframe-src="https://amp.dev/sw.html"
    layout="nodisplay">
  </amp-install-serviceworker>
</body>
</html>
  
